<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Augusto's Clapping Game</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
    background: linear-gradient(to bottom, #f9f7fc, #e3f2fd);
    padding: 20px;
  }
  h1 { color: #4a148c; }
  #palavra { 
    font-size: 48px;
    font-weight: bold;
    color: #4a148c;
    margin: 20px 0;
  }
  #traducao {
    font-size: 24px;
    color: #666;
    margin: 10px 0;
    font-style: italic;
  }
  /* Progress */
  #progresso {
    font-size: 20px;
    color: #1565c0;
    font-weight: bold;
    margin: 10px 0;
  }
  
  .barra-progresso {
    width: 300px;
    height: 15px;
    background: #e0e0e0;
    border-radius: 10px;
    margin: 10px auto;
    overflow: hidden;
    position: relative;
  }
  
  .progresso-fill {
    height: 100%;
    background: linear-gradient(45deg, #42a5f5, #1e88e5);
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 10px;
  }
  
  #palma-btn { font-size: 100px; cursor: pointer; transition: transform 0.2s; }
  #palma-btn:active { transform: scale(1.2); }
  #palmas { font-size: 30px; margin: 15px 0; min-height: 40px; }
  #contador { font-size: 22px; margin: 10px 0; color: #1565c0; }
  #dica { font-size: 20px; margin: 10px 0; color: #7b1fa2; font-weight: bold; display: none; }
  .btn { font-size: 18px; padding: 10px 20px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s; }
  .btn-remove { background: #ef5350; color: white; }
  .btn-remove:hover { background: #e53935; }
  .btn-check { background: #42a5f5; color: white; }
  .btn-check:hover { background: #1e88e5; }
  .btn-next { background: #ffca28; color: #4e342e; }
  .btn-next:hover { background: #ffb300; }
  .btn-hint { background: #9c27b0; color: white; }
  .btn-hint:hover { background: #8e24aa; }
  .btn-toggle-mic { background: #4caf50; color: white; }
  .btn-toggle-mic:hover { background: #45a049; }
  .btn-toggle-mic.desligado { background: #f44336; }
  .btn-toggle-mic.desligado:hover { background: #d32f2f; }
  .btn-reiniciar { background: #4caf50; color: white; }
  .btn-reiniciar:hover { background: #45a049; }
  #resultado { font-size: 26px; font-weight: bold; margin-top: 15px; display: none; }
  #resultado.certo { color: green; animation: pulse 0.6s infinite alternate; }
  #resultado.errado { color: red; animation: shake 0.3s infinite; }
  #mensagem-microfone { font-size: 18px; color: #d84315; margin: 10px 0; }
  #status-microfone { font-size: 16px; margin: 10px 0; padding: 10px; border-radius: 5px; }
  .mic-ativo { background: #e8f5e8; color: #2e7d32; }
  .mic-inativo { background: #ffebee; color: #c62828; }
  .volume-indicator { 
    width: 200px; 
    height: 10px; 
    background: #ddd; 
    margin: 10px auto; 
    border-radius: 5px;
    overflow: hidden;
  }
  .volume-bar { 
    height: 100%; 
    background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
    width: 0%; 
    transition: width 0.1s;
  }
  
  /* Congratulations screen */
  .parabens-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  
  .parabens-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    color: white;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    animation: bounceIn 1s ease-out;
  }
  
  .parabens-titulo {
    font-size: 48px;
    margin-bottom: 20px;
    animation: glow 2s ease-in-out infinite alternate;
  }
  
  .parabens-texto {
    font-size: 24px;
    margin-bottom: 30px;
  }
  
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #ffcc02;
    animation: fall 3s linear infinite;
  }
  
  .confetti:nth-child(odd) { background: #ff6b6b; animation-delay: 0.5s; }
  .confetti:nth-child(even) { background: #4ecdc4; animation-delay: 1s; }
  
  @keyframes pulse { from {transform: scale(1);} to {transform: scale(1.2);} }
  @keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-5px);}100%{transform:translateX(0);} }
  
  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes glow {
    from { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073, 0 0 40px #e60073; }
    to { text-shadow: 0 0 20px #fff, 0 0 30px #ff4da6, 0 0 40px #ff4da6, 0 0 50px #ff4da6; }
  }
  
  @keyframes fall {
    to { transform: translateY(100vh) rotate(360deg); }
  }
  
  .nivel-indicator {
    font-size: 18px;
    color: #666;
    margin: 10px 0;
    background: #f0f0f0;
    padding: 5px 15px;
    border-radius: 20px;
    display: inline-block;
  }
  
  .instructions {
    background: #fff3e0;
    padding: 15px;
    border-radius: 10px;
    margin: 20px auto;
    max-width: 600px;
    font-size: 16px;
    color: #5d4037;
  }
</style>
</head>
<body>
<h1>üéì Teacher Augusto's Clapping Game üëè</h1>

<div class="instructions">
  <strong>How to play:</strong> Clap once for each syllable in the word. Click the clap emoji or use your microphone!
</div>

<div id="progresso">1/40</div>
<div class="barra-progresso">
  <div class="progresso-fill" id="progresso-fill"></div>
</div>

<div class="nivel-indicator" id="nivel">Level: 1 syllable</div>

<p id="palavra">BALL</p>
<div id="dica">üí° BALL - 1 syllable</div>

<div id="palma-btn">üëè</div>
<div id="contador">0 claps</div>
<div id="palmas"></div>

<div id="status-microfone" class="mic-inativo">
  üé§ Microphone: Off
</div>

<div class="volume-indicator">
  <div class="volume-bar" id="volume-bar"></div>
</div>

<div id="mensagem-microfone"></div>

<button class="btn btn-remove" onclick="removerPalma()">Remove Clap</button>
<button class="btn btn-check" onclick="conferir()">Check Answer</button>
<button class="btn btn-hint" onclick="mostrarDica()">üí° Hint</button>
<button class="btn btn-next" onclick="proxima()">Next Word</button>
<button class="btn btn-toggle-mic" id="toggle-mic" onclick="toggleMicrofone()">Turn On Microphone</button>

<div id="resultado"></div>

<!-- Congratulations screen -->
<div class="parabens-overlay" id="parabens-overlay">
  <div class="parabens-content">
    <div class="parabens-titulo">üéâ CONGRATULATIONS! üéâ</div>
    <div class="parabens-texto">
      You completed all 40 words!<br>
      Excellent work with syllables! üëè<br>
      You are amazing! üåü
    </div>
    <button class="btn btn-reiniciar" onclick="reiniciarJogo()">üîÑ Play Again</button>
  </div>
</div>

<script>
const palavras = [
  // One syllable (11 words)
  { texto: "BALL", silabas: 1, dica: "BALL - 1 syllable" },
  { texto: "DOG", silabas: 1, dica: "DOG - 1 syllable" },
  { texto: "CAT", silabas: 1, dica: "CAT - 1 syllable" },
  { texto: "SUN", silabas: 1, dica: "SUN - 1 syllable" },
  { texto: "FISH", silabas: 1, dica: "FISH - 1 syllable" },
  { texto: "CAR", silabas: 1, dica: "CAR - 1 syllable" },
  { texto: "MILK", silabas: 1, dica: "MILK - 1 syllable" },
  { texto: "BREAD", silabas: 1, dica: "BREAD - 1 syllable" },
  { texto: "TREE", silabas: 1, dica: "TREE - 1 syllable" },
  { texto: "BIRD", silabas: 1, dica: "BIRD - 1 syllable" },
  { texto: "CAKE", silabas: 1, dica: "CAKE - 1 syllable" },
  
  // Two syllables (12 words)
  { texto: "APPLE", silabas: 2, dica: "AP-PLE" },
  { texto: "TIGER", silabas: 2, dica: "TI-GER" },
  { texto: "RABBIT", silabas: 2, dica: "RAB-BIT" },
  { texto: "FLOWER", silabas: 2, dica: "FLOW-ER" },
  { texto: "PENCIL", silabas: 2, dica: "PEN-CIL" },
  { texto: "PUPPY", silabas: 2, dica: "PUP-PY" },
  { texto: "ZEBRA", silabas: 2, dica: "ZE-BRA" },
  { texto: "COOKIE", silabas: 2, dica: "COOK-IE" },
  { texto: "MONKEY", silabas: 2, dica: "MON-KEY" },
  { texto: "TABLE", silabas: 2, dica: "TA-BLE" },
  { texto: "PIZZA", silabas: 2, dica: "PIZ-ZA" },
  { texto: "POPCORN", silabas: 2, dica: "POP-CORN" },
  
  // Three syllables (9 words)
  { texto: "ELEPHANT", silabas: 3, dica: "EL-E-PHANT" },
  { texto: "STRAWBERRY", silabas: 3, dica: "STRAW-BER-RY" },
  { texto: "BUTTERFLY", silabas: 3, dica: "BUT-TER-FLY" },
  { texto: "TOMATO", silabas: 3, dica: "TO-MA-TO" },
  { texto: "BANANA", silabas: 3, dica: "BA-NA-NA" },
  { texto: "CHOCOLATE", silabas: 3, dica: "CHOC-O-LATE" },
  { texto: "UMBRELLA", silabas: 3, dica: "UM-BREL-LA" },
  { texto: "POTATO", silabas: 3, dica: "PO-TA-TO" },
  { texto: "AVOCADO", silabas: 4, dica: "AV-O-CA-DO" },
  
  // Three and four syllables (7 words)
  { texto: "WATERMELON", silabas: 4, dica: "WA-TER-MEL-ON" },
  { texto: "CROCODILE", silabas: 3, dica: "CRO-CO-DILE" },
  { texto: "KANGAROO", silabas: 3, dica: "KAN-GA-ROO" },
  { texto: "PINEAPPLE", silabas: 3, dica: "PINE-AP-PLE" },
  { texto: "ALLIGATOR", silabas: 4, dica: "AL-LI-GA-TOR" },
  { texto: "HELICOPTER", silabas: 4, dica: "HEL-I-COP-TER" },
  { texto: "DINOSAUR", silabas: 3, dica: "DI-NO-SAUR" }
];

let indice = 0;
let contagem = 0;
let microfoneAtivo = false;
let audioContext = null;
let analyser = null;
let ultimaPalma = 0;
let dicaMostrada = false;

const palavraEl = document.getElementById("palavra");
const dicaEl = document.getElementById("dica");
const palmasEl = document.getElementById("palmas");
const contadorEl = document.getElementById("contador");
const resultadoEl = document.getElementById("resultado");
const mensagemMicrofoneEl = document.getElementById("mensagem-microfone");
const statusMicrofoneEl = document.getElementById("status-microfone");
const volumeBarEl = document.getElementById("volume-bar");
const toggleMicBtn = document.getElementById("toggle-mic");
const palmaBtn = document.getElementById("palma-btn");
const progressoEl = document.getElementById("progresso");
const progressoFillEl = document.getElementById("progresso-fill");
const parabensOverlay = document.getElementById("parabens-overlay");
const nivelEl = document.getElementById("nivel");

// Update counter and emojis
function atualizarContagem() {
  contadorEl.textContent = contagem + (contagem===1 ? " clap" : " claps");
  palmasEl.textContent = "üëè".repeat(contagem);
}

// Update level
function atualizarNivel() {
  const silabas = palavras[indice].silabas;
  let nivelTexto = "";
  if (silabas === 1) nivelTexto = "Level: 1 syllable";
  else nivelTexto = `Level: ${silabas} syllables`;
  nivelEl.textContent = nivelTexto;
}

// Update progress
function atualizarProgresso() {
  const atual = indice + 1;
  const total = palavras.length;
  progressoEl.textContent = `${atual}/${total}`;
  
  const porcentagem = (atual / total) * 100;
  progressoFillEl.style.width = porcentagem + "%";
}

// Show congratulations animation
function mostrarParabens() {
  parabensOverlay.style.display = "flex";
  
  // Create confetti
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 3 + 's';
      confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
      parabensOverlay.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 5000);
    }, i * 50);
  }
}

// Restart game
function reiniciarJogo() {
  indice = 0;
  contagem = 0;
  dicaMostrada = false;
  parabensOverlay.style.display = "none";
  
  palavraEl.textContent = palavras[indice].texto;
  atualizarContagem();
  atualizarProgresso();
  atualizarNivel();
  resultadoEl.style.display = "none";
  dicaEl.style.display = "none";
}

// Show hint
function mostrarDica() {
  if (!dicaMostrada) {
    dicaEl.textContent = "üí° " + palavras[indice].dica;
    dicaEl.style.display = "block";
    dicaMostrada = true;
  } else {
    dicaEl.style.display = "none";
    dicaMostrada = false;
  }
}

// Click on emoji
palmaBtn.addEventListener("click", () => {
  contagem++;
  atualizarContagem();
});

// Remove clap
function removerPalma() {
  if(contagem>0){ contagem--; atualizarContagem(); }
}

// Check answer
function conferir() {
  const certo = contagem === palavras[indice].silabas;
  resultadoEl.style.display = "block";
  if(certo){
    resultadoEl.textContent = "‚úÖ Great job! Well done!";
    resultadoEl.className = "certo";
  }else{
    resultadoEl.textContent = `‚ùå Try again! The answer is ${palavras[indice].silabas} syllable${palavras[indice].silabas > 1 ? 's' : ''}`;
    resultadoEl.className = "errado";
  }
}

// Next word
function proxima() {
  indice++;
  
  // Check if completed all words
  if (indice >= palavras.length) {
    mostrarParabens();
    return;
  }
  
  palavraEl.textContent = palavras[indice].texto;
  contagem = 0;
  dicaMostrada = false;
  atualizarContagem();
  atualizarProgresso();
  atualizarNivel();
  resultadoEl.style.display = "none";
  dicaEl.style.display = "none";
}

// Toggle microphone
function toggleMicrofone() {
  if (microfoneAtivo) {
    desligarMicrofone();
  } else {
    ligarMicrofone();
  }
}

// Turn on microphone
function ligarMicrofone() {
  navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    analyser.smoothingTimeConstant = 0.3;
    mic.connect(analyser);
    
    microfoneAtivo = true;
    statusMicrofoneEl.textContent = "üé§ Microphone: On - Clap your hands!";
    statusMicrofoneEl.className = "mic-ativo";
    toggleMicBtn.textContent = "Turn Off Microphone";
    toggleMicBtn.classList.add("desligado");
    mensagemMicrofoneEl.textContent = "";
    
    detectarPalmas();
  })
  .catch(err => {
    console.warn("Error accessing microphone:", err);
    mensagemMicrofoneEl.textContent = "‚ùå Could not access microphone. Please click the clap emoji üëè instead";
  });
}

// Turn off microphone
function desligarMicrofone() {
  if (audioContext) {
    audioContext.close();
    audioContext = null;
  }
  microfoneAtivo = false;
  statusMicrofoneEl.textContent = "üé§ Microphone: Off";
  statusMicrofoneEl.className = "mic-inativo";
  toggleMicBtn.textContent = "Turn On Microphone";
  toggleMicBtn.classList.remove("desligado");
  volumeBarEl.style.width = "0%";
}

// Detect claps with better algorithm
function detectarPalmas() {
  if (!microfoneAtivo || !analyser) return;

  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(dataArray);

  let sum = 0;
  for (let i = 0; i < dataArray.length; i++) {
    sum += dataArray[i] * dataArray[i];
  }
  const rms = Math.sqrt(sum / dataArray.length);

  const volumePercent = Math.min((rms / 50) * 100, 100);
  volumeBarEl.style.width = volumePercent + "%";

  const thresholdRMS = 95; 
  const minFreqEnergy = 25; 
  const delayMinimo = 350;
  const agora = Date.now();

  if (rms > thresholdRMS && (agora - ultimaPalma) > delayMinimo) {
    let freqMediaAlta = 0;
    const sampleRate = audioContext.sampleRate;
    const binWidth = sampleRate / analyser.fftSize;

    const startFreqHz = 2000;
    const endFreqHz = 8000;

    const startIndex = Math.floor(startFreqHz / binWidth);
    const endIndex = Math.floor(endFreqHz / binWidth);

    for (let i = startIndex; i < endIndex; i++) {
      freqMediaAlta += dataArray[i];
    }
    freqMediaAlta /= (endIndex - startIndex);

    if (freqMediaAlta > minFreqEnergy) {
      contagem++;
      atualizarContagem();
      ultimaPalma = agora;

      palmaBtn.style.transform = "scale(1.3)";
      setTimeout(() => {
        palmaBtn.style.transform = "scale(1)";
      }, 200);
    }
  }

  requestAnimationFrame(detectarPalmas);
}

// Initialize game
function inicializar() {
  atualizarContagem();
  atualizarProgresso();
  atualizarNivel();
  mensagemMicrofoneEl.textContent = "üí° Tip: Click 'Turn On Microphone' to detect claps automatically!";
}

inicializar();
</script>
</body>
</html>
