<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo das Palmas</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
    background: linear-gradient(to bottom, #f9f7fc, #e3f2fd);
    padding: 20px;
  }
  h1 { color: #4a148c; }
  #palma-btn { font-size: 100px; cursor: pointer; transition: transform 0.2s; }
  #palma-btn:active { transform: scale(1.2); }
  #palmas { font-size: 30px; margin: 15px 0; min-height: 40px; }
  #contador { font-size: 22px; margin: 10px 0; color: #1565c0; }
  .btn { font-size: 18px; padding: 10px 20px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s; }
  .btn-remove { background: #ef5350; color: white; }
  .btn-remove:hover { background: #e53935; }
  .btn-check { background: #42a5f5; color: white; }
  .btn-check:hover { background: #1e88e5; }
  .btn-next { background: #ffca28; color: #4e342e; }
  .btn-next:hover { background: #ffb300; }
  .btn-toggle-mic { background: #4caf50; color: white; }
  .btn-toggle-mic:hover { background: #45a049; }
  .btn-toggle-mic.desligado { background: #f44336; }
  .btn-toggle-mic.desligado:hover { background: #d32f2f; }
  #resultado { font-size: 26px; font-weight: bold; margin-top: 15px; display: none; }
  #resultado.certo { color: green; animation: pulse 0.6s infinite alternate; }
  #resultado.errado { color: red; animation: shake 0.3s infinite; }
  #mensagem-microfone { font-size: 18px; color: #d84315; margin: 10px 0; }
  #status-microfone { font-size: 16px; margin: 10px 0; padding: 10px; border-radius: 5px; }
  .mic-ativo { background: #e8f5e8; color: #2e7d32; }
  .mic-inativo { background: #ffebee; color: #c62828; }
  .volume-indicator { 
    width: 200px; 
    height: 10px; 
    background: #ddd; 
    margin: 10px auto; 
    border-radius: 5px;
    overflow: hidden;
  }
  .volume-bar { 
    height: 100%; 
    background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
    width: 0%; 
    transition: width 0.1s;
  }
  @keyframes pulse { from {transform: scale(1);} to {transform: scale(1.2);} }
  @keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-5px);}100%{transform:translateX(0);} }
</style>
</head>
<body>
<h1>Jogo das Palmas üëè</h1>
<p id="palavra">BANANA</p>

<div id="palma-btn">üëè</div>
<div id="contador">0 palmas</div>
<div id="palmas"></div>

<div id="status-microfone" class="mic-inativo">
  üé§ Microfone: Desligado
</div>

<div class="volume-indicator">
  <div class="volume-bar" id="volume-bar"></div>
</div>

<div id="mensagem-microfone"></div>

<button class="btn btn-remove" onclick="removerPalma()">Remover Palmas</button>
<button class="btn btn-check" onclick="conferir()">Conferir</button>
<button class="btn btn-next" onclick="proxima()">Pr√≥ximo</button>
<button class="btn btn-toggle-mic" id="toggle-mic" onclick="toggleMicrofone()">Ligar Microfone</button>

<div id="resultado"></div>

<script>
const palavras = [
  { texto: "BANANA", silabas: 3 }, { texto: "CACHORRO", silabas: 3 },
¬† { texto: "ELEFANTE", silabas: 4 }, { texto: "UVA", silabas: 2 },
¬† { texto: "JACAR√â", silabas: 3 }, { texto: "GATO", silabas: 2 },
¬† { texto: "CASA", silabas: 2 }, { texto: "PATO", silabas: 2 },
¬† { texto: "BONECA", silabas: 3 }, { texto: "MENINO", silabas: 3 },
¬† { texto: "MENINA", silabas: 3 }, { texto: "ESCOLA", silabas: 3 },
¬† { texto: "CARRO", silabas: 2 }, { texto: "MOTO", silabas: 2 },
¬† { texto: "CAVALO", silabas: 3 }, { texto: "ABELHA", silabas: 3 },
¬† { texto: "BOLA", silabas: 2 }, { texto: "BOLO", silabas: 2 },
¬† { texto: "CHUVA", silabas: 2 }, { texto: "PEIXE", silabas: 2 },
¬† { texto: "GALINHA", silabas: 3 }, { texto: "SAPO", silabas: 2 },
¬† { texto: "BEB√ä", silabas: 2 }, { texto: "FOCA", silabas: 2 },
¬† { texto: "MACACO", silabas: 3 }, { texto: "ON√áA", silabas: 2 },
¬† { texto: "LE√ÉO", silabas: 2 }, { texto: "TIGRE", silabas: 2 },
¬† { texto: "FORMIGA", silabas: 3 }, { texto: "FLOR", silabas: 1 },
¬† { texto: "COPO", silabas: 2 }, { texto: "MESA", silabas: 2 },
¬† { texto: "CADEIRA", silabas: 3 }, { texto: "SAPATO", silabas: 3 },
¬† { texto: "CAMISA", silabas: 3 }, { texto: "SAIA", silabas: 2 },
¬† { texto: "CAL√áA", silabas: 2 }, { texto: "CHAP√âU", silabas: 2 },
¬† { texto: "REL√ìGIO", silabas: 3 }, { texto: "BONECO", silabas: 3 },
¬† { texto: "DENTE", silabas: 2 }, { texto: "CABELO", silabas: 3 },
¬† { texto: "OLHO", silabas: 2 }, { texto: "NARIZ", silabas: 2 },
¬† { texto: "ORELHA", silabas: 3 }, { texto: "BOCA", silabas: 2 },
¬† { texto: "PEITO", silabas: 2 }, { texto: "BRA√áO", silabas: 2 },
¬† { texto: "PERNA", silabas: 2 }, { texto: "M√ÉO", silabas: 1 },
¬† { texto: "P√â", silabas: 1 }, { texto: "L√ÅPIS", silabas: 2 },
¬† { texto: "CANETA", silabas: 3 }, { texto: "CADERNO", silabas: 3 },
¬† { texto: "LIVRO", silabas: 2 }, { texto: "BORRACHA", silabas: 3 },
¬† { texto: "R√âGUA", silabas: 2 }, { texto: "QUADRO", silabas: 2 },
¬† { texto: "GIZ", silabas: 1 }, { texto: "PROFESSOR", silabas: 3 },
¬† { texto: "ALUNA", silabas: 3 }, { texto: "AMIGO", silabas: 3 },
¬† { texto: "AMIGA", silabas: 3 }, { texto: "SOL", silabas: 1 },
¬† { texto: "LUA", silabas: 2 }, { texto: "ESTRELA", silabas: 3 },
¬† { texto: "C√âU", silabas: 1 }, { texto: "√ÅRVORE", silabas: 3 },
¬† { texto: "FOLHA", silabas: 2 }, { texto: "FRUTA", silabas: 2 },
¬† { texto: "MA√á√É", silabas: 2 }, { texto: "PERA", silabas: 2 },
¬† { texto: "LARANJA", silabas: 3 }, { texto: "MELANCIA", silabas: 4 },
¬† { texto: "MORANGO", silabas: 3 }, { texto: "ABACAXI", silabas: 4 },
¬† { texto: "LIM√ÉO", silabas: 2 }, { texto: "TOMATE", silabas: 3 },
¬† { texto: "BATATA", silabas: 3 }, { texto: "CENOURA", silabas: 3 },
¬† { texto: "FEIJ√ÉO", silabas: 2 }, { texto: "ARROZ", silabas: 2 },
¬† { texto: "P√ÉO", silabas: 1 }, { texto: "LEITE", silabas: 2 },
¬† { texto: "QUEIJO", silabas: 2 }, { texto: "OVO", silabas: 2 },
¬† { texto: "CARNE", silabas: 2 }, { texto: "SOPA", silabas: 2 },
¬† { texto: "PIZZA", silabas: 2 }, { texto: "DOCE", silabas: 2 },
¬† { texto: "BISCOITO", silabas: 3 }, { texto: "SORVETE", silabas: 3 },
¬† { texto: "CHOCOLATE", silabas: 4 }, { texto: "BALA", silabas: 2 },
¬† { texto: "PIPOCA", silabas: 3 }
];

let indice = 0;
let contagem = 0;
let microfoneAtivo = false;
let audioContext = null;
let analyser = null;
let ultimaPalma = 0; // timestamp da √∫ltima palma detectada

const palavraEl = document.getElementById("palavra");
const palmasEl = document.getElementById("palmas");
const contadorEl = document.getElementById("contador");
const resultadoEl = document.getElementById("resultado");
const mensagemMicrofoneEl = document.getElementById("mensagem-microfone");
const statusMicrofoneEl = document.getElementById("status-microfone");
const volumeBarEl = document.getElementById("volume-bar");
const toggleMicBtn = document.getElementById("toggle-mic");
const palmaBtn = document.getElementById("palma-btn");

// Atualiza contador e emojis
function atualizarContagem() {
  contadorEl.textContent = contagem + (contagem===1 ? " palma" : " palmas");
  palmasEl.textContent = "üëè".repeat(contagem);
}

// Clique no emoji
palmaBtn.addEventListener("click", () => {
  contagem++;
  atualizarContagem();
});

// Remover palma
function removerPalma() {
  if(contagem>0){ contagem--; atualizarContagem(); }
}

// Conferir resposta
function conferir() {
  const certo = contagem === palavras[indice].silabas;
  resultadoEl.style.display = "block";
  if(certo){
    resultadoEl.textContent = "‚úÖ Muito bem!";
    resultadoEl.className = "certo";
  }else{
    resultadoEl.textContent = `‚ùå Tente novamente! A resposta √© ${palavras[indice].silabas} s√≠laba${palavras[indice].silabas > 1 ? 's' : ''}`;
    resultadoEl.className = "errado";
  }
}

// Pr√≥xima palavra
function proxima() {
  indice = (indice + 1) % palavras.length;
  palavraEl.textContent = palavras[indice].texto;
  contagem = 0;
  atualizarContagem();
  resultadoEl.style.display = "none";
}

// Toggle microfone
function toggleMicrofone() {
  if (microfoneAtivo) {
    desligarMicrofone();
  } else {
    ligarMicrofone();
  }
}

// Ligar microfone
function ligarMicrofone() {
  navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    analyser.smoothingTimeConstant = 0.3;
    mic.connect(analyser);
    
    microfoneAtivo = true;
    statusMicrofoneEl.textContent = "üé§ Microfone: Ligado - Bata palmas!";
    statusMicrofoneEl.className = "mic-ativo";
    toggleMicBtn.textContent = "Desligar Microfone";
    toggleMicBtn.classList.add("desligado");
    mensagemMicrofoneEl.textContent = "";
    
    detectarPalmas();
  })
  .catch(err => {
    console.warn("Erro ao acessar microfone:", err);
    mensagemMicrofoneEl.textContent = "‚ùå N√£o foi poss√≠vel acessar o microfone. Use o clique no emoji üëè";
  });
}

// Desligar microfone
function desligarMicrofone() {
  if (audioContext) {
    audioContext.close();
    audioContext = null;
  }
  microfoneAtivo = false;
  statusMicrofoneEl.textContent = "üé§ Microfone: Desligado";
  statusMicrofoneEl.className = "mic-inativo";
  toggleMicBtn.textContent = "Ligar Microfone";
  toggleMicBtn.classList.remove("desligado");
  volumeBarEl.style.width = "0%";
}

// Detectar palmas com melhor algoritmo
function detectarPalmas() {
  if (!microfoneAtivo || !analyser) return;

  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(dataArray);

  let sum = 0;
  for (let i = 0; i < dataArray.length; i++) {
    sum += dataArray[i] * dataArray[i];
  }
  const rms = Math.sqrt(sum / dataArray.length);

  const volumePercent = Math.min((rms / 50) * 100, 100);
  volumeBarEl.style.width = volumePercent + "%";

  const thresholdRMS = 95; 
  const minFreqEnergy = 25; 
  const delayMinimo = 350;
  const agora = Date.now();

  if (rms > thresholdRMS && (agora - ultimaPalma) > delayMinimo) {
    let freqMediaAlta = 0;
    const sampleRate = audioContext.sampleRate;
    const binWidth = sampleRate / analyser.fftSize;

    const startFreqHz = 2000;
    const endFreqHz = 8000;

    const startIndex = Math.floor(startFreqHz / binWidth);
    const endIndex = Math.floor(endFreqHz / binWidth);

    for (let i = startIndex; i < endIndex; i++) {
      freqMediaAlta += dataArray[i];
    }
    freqMediaAlta /= (endIndex - startIndex);

    if (freqMediaAlta > minFreqEnergy) {
      contagem++;
      atualizarContagem();
      ultimaPalma = agora;

      palmaBtn.style.transform = "scale(1.3)";
      setTimeout(() => {
        palmaBtn.style.transform = "scale(1)";
      }, 200);
    }
  }

  requestAnimationFrame(detectarPalmas);
}

// Inicializa contador
atualizarContagem();

// Info inicial
mensagemMicrofoneEl.textContent = "üí° Dica: Clique em 'Ligar Microfone' para detectar palmas automaticamente!";
</script>
</body>
</html>











