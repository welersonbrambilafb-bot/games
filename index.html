<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo das Palmas</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
    background: linear-gradient(to bottom, #f9f7fc, #e3f2fd);
    padding: 20px;
  }
  h1 { color: #4a148c; }
  #palma-btn { font-size: 100px; cursor: pointer; transition: transform 0.2s; }
  #palma-btn:active { transform: scale(1.2); }
  #palmas { font-size: 30px; margin: 15px 0; min-height: 40px; }
  #contador { font-size: 22px; margin: 10px 0; color: #1565c0; }
  .btn { font-size: 18px; padding: 10px 20px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s; }
  .btn-remove { background: #ef5350; color: white; }
  .btn-remove:hover { background: #e53935; }
  .btn-check { background: #42a5f5; color: white; }
  .btn-check:hover { background: #1e88e5; }
  .btn-next { background: #ffca28; color: #4e342e; }
  .btn-next:hover { background: #ffb300; }
  .btn-toggle-mic { background: #4caf50; color: white; }
  .btn-toggle-mic:hover { background: #45a049; }
  .btn-toggle-mic.desligado { background: #f44336; }
  .btn-toggle-mic.desligado:hover { background: #d32f2f; }
  #resultado { font-size: 26px; font-weight: bold; margin-top: 15px; display: none; }
  #resultado.certo { color: green; animation: pulse 0.6s infinite alternate; }
  #resultado.errado { color: red; animation: shake 0.3s infinite; }
  #mensagem-microfone { font-size: 18px; color: #d84315; margin: 10px 0; }
  #status-microfone { font-size: 16px; margin: 10px 0; padding: 10px; border-radius: 5px; }
  .mic-ativo { background: #e8f5e8; color: #2e7d32; }
  .mic-inativo { background: #ffebee; color: #c62828; }
  .volume-indicator { 
    width: 200px; 
    height: 10px; 
    background: #ddd; 
    margin: 10px auto; 
    border-radius: 5px;
    overflow: hidden;
  }
  .volume-bar { 
    height: 100%; 
    background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
    width: 0%; 
    transition: width 0.1s;
  }
  @keyframes pulse { from {transform: scale(1);} to {transform: scale(1.2);} }
  @keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-5px);}100%{transform:translateX(0);} }
</style>
</head>
<body>
<h1>Jogo das Palmas üëè</h1>
<p id="palavra">Banana</p>

<div id="palma-btn">üëè</div>
<div id="contador">0 palmas</div>
<div id="palmas"></div>

<div id="status-microfone" class="mic-inativo">
  üé§ Microfone: Desligado
</div>

<div class="volume-indicator">
  <div class="volume-bar" id="volume-bar"></div>
</div>

<div id="mensagem-microfone"></div>

<button class="btn btn-remove" onclick="removerPalma()">Remover Palmas</button>
<button class="btn btn-check" onclick="conferir()">Conferir</button>
<button class="btn btn-next" onclick="proxima()">Pr√≥ximo</button>
<button class="btn btn-toggle-mic" id="toggle-mic" onclick="toggleMicrofone()">Ligar Microfone</button>

<div id="resultado"></div>

<script>
const palavras = [
  { texto: "Banana", silabas: 3 }, { texto: "Cachorro", silabas: 3 },
  { texto: "Elefante", silabas: 4 }, { texto: "Uva", silabas: 2 },
  { texto: "Jacar√©", silabas: 3 }, { texto: "Gato", silabas: 2 },
  { texto: "Casa", silabas: 2 }, { texto: "Pato", silabas: 2 },
  { texto: "Boneca", silabas: 3 }, { texto: "Menino", silabas: 3 },
  { texto: "Menina", silabas: 3 }, { texto: "Escola", silabas: 3 },
  { texto: "Carro", silabas: 2 }, { texto: "Moto", silabas: 2 },
  { texto: "Cavalo", silabas: 3 }, { texto: "Abelha", silabas: 3 },
  { texto: "Bola", silabas: 2 }, { texto: "Bolo", silabas: 2 },
  { texto: "Chuva", silabas: 2 }, { texto: "Peixe", silabas: 2 },
  { texto: "Galinha", silabas: 3 }, { texto: "Sapo", silabas: 2 },
  { texto: "Beb√™", silabas: 2 }, { texto: "Foca", silabas: 2 },
  { texto: "Macaco", silabas: 3 }, { texto: "On√ßa", silabas: 2 },
  { texto: "Le√£o", silabas: 2 }, { texto: "Tigre", silabas: 2 },
  { texto: "Formiga", silabas: 3 }, { texto: "Flor", silabas: 1 },
  { texto: "Copo", silabas: 2 }, { texto: "Mesa", silabas: 2 },
  { texto: "Cadeira", silabas: 3 }, { texto: "Sapato", silabas: 3 },
  { texto: "Camisa", silabas: 3 }, { texto: "Saia", silabas: 2 },
  { texto: "Cal√ßa", silabas: 2 }, { texto: "Chap√©u", silabas: 2 },
  { texto: "Rel√≥gio", silabas: 3 }, { texto: "Boneco", silabas: 3 },
  { texto: "Dente", silabas: 2 }, { texto: "Cabelo", silabas: 3 },
  { texto: "Olho", silabas: 2 }, { texto: "Nariz", silabas: 2 },
  { texto: "Orelha", silabas: 3 }, { texto: "Boca", silabas: 2 },
  { texto: "Peito", silabas: 2 }, { texto: "Bra√ßo", silabas: 2 },
  { texto: "Perna", silabas: 2 }, { texto: "M√£o", silabas: 1 },
  { texto: "P√©", silabas: 1 }, { texto: "L√°pis", silabas: 2 },
  { texto: "Caneta", silabas: 3 }, { texto: "Caderno", silabas: 3 },
  { texto: "Livro", silabas: 2 }, { texto: "Borracha", silabas: 3 },
  { texto: "R√©gua", silabas: 2 }, { texto: "Quadro", silabas: 2 },
  { texto: "Giz", silabas: 1 }, { texto: "Professor", silabas: 3 },
  { texto: "Aluna", silabas: 3 }, { texto: "Amigo", silabas: 3 },
  { texto: "Amiga", silabas: 3 }, { texto: "Sol", silabas: 1 },
  { texto: "Lua", silabas: 2 }, { texto: "Estrela", silabas: 3 },
  { texto: "C√©u", silabas: 1 }, { texto: "√Årvore", silabas: 3 },
  { texto: "Folha", silabas: 2 }, { texto: "Fruta", silabas: 2 },
  { texto: "Ma√ß√£", silabas: 2 }, { texto: "Pera", silabas: 2 },
  { texto: "Laranja", silabas: 3 }, { texto: "Melancia", silabas: 4 },
  { texto: "Morango", silabas: 3 }, { texto: "Abacaxi", silabas: 4 },
  { texto: "Lim√£o", silabas: 2 }, { texto: "Tomate", silabas: 3 },
  { texto: "Batata", silabas: 3 }, { texto: "Cenoura", silabas: 3 },
  { texto: "Feij√£o", silabas: 2 }, { texto: "Arroz", silabas: 2 },
  { texto: "P√£o", silabas: 1 }, { texto: "Leite", silabas: 2 },
  { texto: "Queijo", silabas: 2 }, { texto: "Ovo", silabas: 2 },
  { texto: "Carne", silabas: 2 }, { texto: "Sopa", silabas: 2 },
  { texto: "Pizza", silabas: 2 }, { texto: "Doce", silabas: 2 },
  { texto: "Biscoito", silabas: 3 }, { texto: "Sorvete", silabas: 3 },
  { texto: "Chocolate", silabas: 4 }, { texto: "Bala", silabas: 2 },
  { texto: "Pipoca", silabas: 3 }
];

let indice = 0;
let contagem = 0;
let microfoneAtivo = false;
let audioContext = null;
let analyser = null;
let ultimaPalma = 0; // timestamp da √∫ltima palma detectada

const palavraEl = document.getElementById("palavra");
const palmasEl = document.getElementById("palmas");
const contadorEl = document.getElementById("contador");
const resultadoEl = document.getElementById("resultado");
const mensagemMicrofoneEl = document.getElementById("mensagem-microfone");
const statusMicrofoneEl = document.getElementById("status-microfone");
const volumeBarEl = document.getElementById("volume-bar");
const toggleMicBtn = document.getElementById("toggle-mic");
const palmaBtn = document.getElementById("palma-btn");

// Atualiza contador e emojis
function atualizarContagem() {
  contadorEl.textContent = contagem + (contagem===1 ? " palma" : " palmas");
  palmasEl.textContent = "üëè".repeat(contagem);
}

// Clique no emoji
palmaBtn.addEventListener("click", () => {
  contagem++;
  atualizarContagem();
});

// Remover palma
function removerPalma() {
  if(contagem>0){ contagem--; atualizarContagem(); }
}

// Conferir resposta
function conferir() {
  const certo = contagem === palavras[indice].silabas;
  resultadoEl.style.display = "block";
  if(certo){
    resultadoEl.textContent = "‚úÖ Muito bem!";
    resultadoEl.className = "certo";
  }else{
    resultadoEl.textContent = `‚ùå Tente novamente! A resposta √© ${palavras[indice].silabas} s√≠laba${palavras[indice].silabas > 1 ? 's' : ''}`;
    resultadoEl.className = "errado";
  }
}

// Pr√≥xima palavra
function proxima() {
  indice = (indice + 1) % palavras.length;
  palavraEl.textContent = palavras[indice].texto;
  contagem = 0;
  atualizarContagem();
  resultadoEl.style.display = "none";
}

// Toggle microfone
function toggleMicrofone() {
  if (microfoneAtivo) {
    desligarMicrofone();
  } else {
    ligarMicrofone();
  }
}

// Ligar microfone
function ligarMicrofone() {
  navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    analyser.smoothingTimeConstant = 0.3;
    mic.connect(analyser);
    
    microfoneAtivo = true;
    statusMicrofoneEl.textContent = "üé§ Microfone: Ligado - Bata palmas!";
    statusMicrofoneEl.className = "mic-ativo";
    toggleMicBtn.textContent = "Desligar Microfone";
    toggleMicBtn.classList.add("desligado");
    mensagemMicrofoneEl.textContent = "";
    
    detectarPalmas();
  })
  .catch(err => {
    console.warn("Erro ao acessar microfone:", err);
    mensagemMicrofoneEl.textContent = "‚ùå N√£o foi poss√≠vel acessar o microfone. Use o clique no emoji üëè";
  });
}

// Desligar microfone
function desligarMicrofone() {
  if (audioContext) {
    audioContext.close();
    audioContext = null;
  }
  microfoneAtivo = false;
  statusMicrofoneEl.textContent = "üé§ Microfone: Desligado";
  statusMicrofoneEl.className = "mic-inativo";
  toggleMicBtn.textContent = "Ligar Microfone";
  toggleMicBtn.classList.remove("desligado");
  volumeBarEl.style.width = "0%";
}

// Detectar palmas com melhor algoritmo
function detectarPalmas() {
  if (!microfoneAtivo || !analyser) return;
  
  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(dataArray);
  
  // Calcular volume RMS (mais preciso que max)
  let sum = 0;
  for (let i = 0; i < dataArray.length; i++) {
    sum += dataArray[i] * dataArray[i];
  }
  const rms = Math.sqrt(sum / dataArray.length);
  
  // Atualizar indicador visual de volume
  const volumePercent = Math.min((rms / 50) * 100, 100);
  volumeBarEl.style.width = volumePercent + "%";
  
  // Detectar picos de som (palmas)
  const threshold = 80; // ajust√°vel
  const agora = Date.now();
  const delayMinimo = 300; // 300ms entre palmas para evitar contagem dupla
  
  if (rms > threshold && (agora - ultimaPalma) > delayMinimo) {
    // Analisar frequ√™ncias m√©dias/altas (caracter√≠stico de palmas)
    let freqMediaAlta = 0;
    const start = Math.floor(dataArray.length * 0.3); // frequ√™ncias m√©dias/altas
    const end = Math.floor(dataArray.length * 0.8);
    
    for (let i = start; i < end; i++) {
      freqMediaAlta += dataArray[i];
    }
    freqMediaAlta /= (end - start);
    
    // Se h√° energia significativa nas freq. m√©dias/altas, provavelmente √© uma palma
    if (freqMediaAlta > 20) {
      contagem++;
      atualizarContagem();
      ultimaPalma = agora;
      
      // Feedback visual
      palmaBtn.style.transform = "scale(1.3)";
      setTimeout(() => {
        palmaBtn.style.transform = "scale(1)";
      }, 200);
    }
  }
  
  requestAnimationFrame(detectarPalmas);
}

// Inicializa contador
atualizarContagem();

// Info inicial
mensagemMicrofoneEl.textContent = "üí° Dica: Clique em 'Ligar Microfone' para detectar palmas automaticamente!";
</script>
</body>
</html>


