<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo das Palmas da ANA LAURA!</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
    background: linear-gradient(to bottom, #f9f7fc, #e3f2fd);
    padding: 20px;
  }
  h1 { color: #4a148c; }
  
  /* Progresso */
  #progresso {
    font-size: 20px;
    color: #1565c0;
    font-weight: bold;
    margin: 10px 0;
  }
  
  .barra-progresso {
    width: 300px;
    height: 15px;
    background: #e0e0e0;
    border-radius: 10px;
    margin: 10px auto;
    overflow: hidden;
    position: relative;
  }
  
  .progresso-fill {
    height: 100%;
    background: linear-gradient(45deg, #42a5f5, #1e88e5);
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 10px;
  }
  
  #palma-btn { font-size: 100px; cursor: pointer; transition: transform 0.2s; }
  #palma-btn:active { transform: scale(1.2); }
  #palmas { font-size: 30px; margin: 15px 0; min-height: 40px; }
  #contador { font-size: 22px; margin: 10px 0; color: #1565c0; }
  #dica { font-size: 20px; margin: 10px 0; color: #7b1fa2; font-weight: bold; display: none; }
  .btn { font-size: 18px; padding: 10px 20px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s; }
  .btn-remove { background: #ef5350; color: white; }
  .btn-remove:hover { background: #e53935; }
  .btn-check { background: #42a5f5; color: white; }
  .btn-check:hover { background: #1e88e5; }
  .btn-next { background: #ffca28; color: #4e342e; }
  .btn-next:hover { background: #ffb300; }
  .btn-hint { background: #9c27b0; color: white; }
  .btn-hint:hover { background: #8e24aa; }
  .btn-toggle-mic { background: #4caf50; color: white; }
  .btn-toggle-mic:hover { background: #45a049; }
  .btn-toggle-mic.desligado { background: #f44336; }
  .btn-toggle-mic.desligado:hover { background: #d32f2f; }
  .btn-reiniciar { background: #4caf50; color: white; }
  .btn-reiniciar:hover { background: #45a049; }
  #resultado { font-size: 26px; font-weight: bold; margin-top: 15px; display: none; }
  #resultado.certo { color: green; animation: pulse 0.6s infinite alternate; }
  #resultado.errado { color: red; animation: shake 0.3s infinite; }
  #mensagem-microfone { font-size: 18px; color: #d84315; margin: 10px 0; }
  #status-microfone { font-size: 16px; margin: 10px 0; padding: 10px; border-radius: 5px; }
  .mic-ativo { background: #e8f5e8; color: #2e7d32; }
  .mic-inativo { background: #ffebee; color: #c62828; }
  .volume-indicator { 
    width: 200px; 
    height: 10px; 
    background: #ddd; 
    margin: 10px auto; 
    border-radius: 5px;
    overflow: hidden;
  }
  .volume-bar { 
    height: 100%; 
    background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
    width: 0%; 
    transition: width 0.1s;
  }
  
  /* Tela de parab√©ns */
  .parabens-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  
  .parabens-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    color: white;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    animation: bounceIn 1s ease-out;
  }
  
  .parabens-titulo {
    font-size: 48px;
    margin-bottom: 20px;
    animation: glow 2s ease-in-out infinite alternate;
  }
  
  .parabens-texto {
    font-size: 24px;
    margin-bottom: 30px;
  }
  
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #ffcc02;
    animation: fall 3s linear infinite;
  }
  
  .confetti:nth-child(odd) { background: #ff6b6b; animation-delay: 0.5s; }
  .confetti:nth-child(even) { background: #4ecdc4; animation-delay: 1s; }
  
  @keyframes pulse { from {transform: scale(1);} to {transform: scale(1.2);} }
  @keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-5px);}100%{transform:translateX(0);} }
  
  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes glow {
    from { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #e60073, 0 0 40px #e60073; }
    to { text-shadow: 0 0 20px #fff, 0 0 30px #ff4da6, 0 0 40px #ff4da6, 0 0 50px #ff4da6; }
  }
  
  @keyframes fall {
    to { transform: translateY(100vh) rotate(360deg); }
  }
</style>
</head>
<body>
<h1>Jogo das Palmas üëè</h1>

<div id="progresso">1/20</div>
<div class="barra-progresso">
  <div class="progresso-fill" id="progresso-fill"></div>
</div>

<p id="palavra">BICICLETA</p>
<div id="dica">üí° BI-CI-CLE-TA</div>

<div id="palma-btn">üëè</div>
<div id="contador">0 palmas</div>
<div id="palmas"></div>

<div id="status-microfone" class="mic-inativo">
  üé§ Microfone: Desligado
</div>

<div class="volume-indicator">
  <div class="volume-bar" id="volume-bar"></div>
</div>

<div id="mensagem-microfone"></div>

<button class="btn btn-remove" onclick="removerPalma()">Remover Palmas</button>
<button class="btn btn-check" onclick="conferir()">Conferir</button>
<button class="btn btn-hint" onclick="mostrarDica()">üí° Dica</button>
<button class="btn btn-next" onclick="proxima()">Pr√≥ximo</button>
<button class="btn btn-toggle-mic" id="toggle-mic" onclick="toggleMicrofone()">Ligar Microfone</button>

<div id="resultado"></div>

<!-- Tela de parab√©ns -->
<div class="parabens-overlay" id="parabens-overlay">
  <div class="parabens-content">
    <div class="parabens-titulo">üéâ PARAB√âNS! üéâ</div>
    <div class="parabens-texto">
      Voc√™ completou todas as 20 palavras!<br>
      Excelente trabalho com as s√≠labas! üëè
    </div>
    <button class="btn btn-reiniciar" onclick="reiniciarJogo()">üîÑ Jogar Novamente</button>
  </div>
</div>

<script>
const palavras = [
  { texto: "BICICLETA", silabas: 4, dica: "BI-CI-CLE-TA" },
  { texto: "TELEVIS√ÉO", silabas: 4, dica: "TE-LE-VI-S√ÉO" },
  { texto: "COMPUTADOR", silabas: 4, dica: "COM-PU-TA-DOR" },
  { texto: "ASTRONAUTA", silabas: 5, dica: "AS-TRO-NAU-TA" },
  { texto: "HIPOP√ìTAMO", silabas: 5, dica: "HI-PO-P√ì-TA-MO" },
  { texto: "CADEIRANTE", silabas: 4, dica: "CA-DEI-RAN-TE" },
  { texto: "BORBOLETA", silabas: 4, dica: "BOR-BO-LE-TA" },
  { texto: "BORRACHA", silabas: 3, dica: "BOR-RA-CHA" },
  { texto: "ARBUSTO", silabas: 3, dica: "AR-BUS-TO" },
  { texto: "JANELA", silabas: 3, dica: "JA-NE-LA" },
  { texto: "ALMO√áO", silabas: 3, dica: "AL-MO-√áO" },
  { texto: "PRESENTE", silabas: 3, dica: "PRE-SEN-TE" },
  { texto: "BRINQUEDO", silabas: 3, dica: "BRIN-QUE-DO" },
  { texto: "PORTA", silabas: 2, dica: "POR-TA" },
  { texto: "LIVRO", silabas: 2, dica: "LI-VRO" },
  { texto: "PAREDE", silabas: 3, dica: "PA-RE-DE" },
  { texto: "VIDRO", silabas: 2, dica: "VI-DRO" },
  { texto: "LEBRE", silabas: 2, dica: "LE-BRE" },
  { texto: "SOL", silabas: 1, dica: "SOL" },
  { texto: "BOMBEIRO", silabas: 3, dica: "BOM-BEI-RO" }
];

let indice = 0;
let contagem = 0;
let microfoneAtivo = false;
let audioContext = null;
let analyser = null;
let ultimaPalma = 0;
let dicaMostrada = false;

const palavraEl = document.getElementById("palavra");
const dicaEl = document.getElementById("dica");
const palmasEl = document.getElementById("palmas");
const contadorEl = document.getElementById("contador");
const resultadoEl = document.getElementById("resultado");
const mensagemMicrofoneEl = document.getElementById("mensagem-microfone");
const statusMicrofoneEl = document.getElementById("status-microfone");
const volumeBarEl = document.getElementById("volume-bar");
const toggleMicBtn = document.getElementById("toggle-mic");
const palmaBtn = document.getElementById("palma-btn");
const progressoEl = document.getElementById("progresso");
const progressoFillEl = document.getElementById("progresso-fill");
const parabensOverlay = document.getElementById("parabens-overlay");

// Atualiza contador e emojis
function atualizarContagem() {
  contadorEl.textContent = contagem + (contagem===1 ? " palma" : " palmas");
  palmasEl.textContent = "üëè".repeat(contagem);
}

// Atualizar progresso
function atualizarProgresso() {
  const atual = indice + 1;
  const total = palavras.length;
  progressoEl.textContent = `${atual}/${total}`;
  
  const porcentagem = (atual / total) * 100;
  progressoFillEl.style.width = porcentagem + "%";
}

// Mostrar anima√ß√£o de parab√©ns
function mostrarParabens() {
  parabensOverlay.style.display = "flex";
  
  // Criar confetes
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 3 + 's';
      confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
      parabensOverlay.appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 5000);
    }, i * 50);
  }
}

// Reiniciar jogo
function reiniciarJogo() {
  indice = 0;
  contagem = 0;
  dicaMostrada = false;
  parabensOverlay.style.display = "none";
  
  palavraEl.textContent = palavras[indice].texto;
  atualizarContagem();
  atualizarProgresso();
  resultadoEl.style.display = "none";
  dicaEl.style.display = "none";
}

// Mostrar dica
function mostrarDica() {
  if (!dicaMostrada) {
    dicaEl.textContent = "üí° " + palavras[indice].dica;
    dicaEl.style.display = "block";
    dicaMostrada = true;
  } else {
    dicaEl.style.display = "none";
    dicaMostrada = false;
  }
}

// Clique no emoji
palmaBtn.addEventListener("click", () => {
  contagem++;
  atualizarContagem();
});

// Remover palma
function removerPalma() {
  if(contagem>0){ contagem--; atualizarContagem(); }
}

// Conferir resposta
function conferir() {
  const certo = contagem === palavras[indice].silabas;
  resultadoEl.style.display = "block";
  if(certo){
    resultadoEl.textContent = "‚úÖ Muito bem!";
    resultadoEl.className = "certo";
  }else{
    resultadoEl.textContent = `‚ùå Tente novamente! A resposta √© ${palavras[indice].silabas} s√≠laba${palavras[indice].silabas > 1 ? 's' : ''}`;
    resultadoEl.className = "errado";
  }
}

// Pr√≥xima palavra
function proxima() {
  indice++;
  
  // Verificar se chegou ao final
  if (indice >= palavras.length) {
    mostrarParabens();
    return;
  }
  
  palavraEl.textContent = palavras[indice].texto;
  contagem = 0;
  dicaMostrada = false;
  atualizarContagem();
  atualizarProgresso();
  resultadoEl.style.display = "none";
  dicaEl.style.display = "none";
}

// Toggle microfone
function toggleMicrofone() {
  if (microfoneAtivo) {
    desligarMicrofone();
  } else {
    ligarMicrofone();
  }
}

// Ligar microfone
function ligarMicrofone() {
  navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const mic = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    analyser.smoothingTimeConstant = 0.3;
    mic.connect(analyser);
    
    microfoneAtivo = true;
    statusMicrofoneEl.textContent = "üé§ Microfone: Ligado - Bata palmas!";
    statusMicrofoneEl.className = "mic-ativo";
    toggleMicBtn.textContent = "Desligar Microfone";
    toggleMicBtn.classList.add("desligado");
    mensagemMicrofoneEl.textContent = "";
    
    detectarPalmas();
  })
  .catch(err => {
    console.warn("Erro ao acessar microfone:", err);
    mensagemMicrofoneEl.textContent = "‚ùå N√£o foi poss√≠vel acessar o microfone. Use o clique no emoji üëè";
  });
}

// Desligar microfone
function desligarMicrofone() {
  if (audioContext) {
    audioContext.close();
    audioContext = null;
  }
  microfoneAtivo = false;
  statusMicrofoneEl.textContent = "üé§ Microfone: Desligado";
  statusMicrofoneEl.className = "mic-inativo";
  toggleMicBtn.textContent = "Ligar Microfone";
  toggleMicBtn.classList.remove("desligado");
  volumeBarEl.style.width = "0%";
}

// Detectar palmas com melhor algoritmo
function detectarPalmas() {
  if (!microfoneAtivo || !analyser) return;

  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(dataArray);

  let sum = 0;
  for (let i = 0; i < dataArray.length; i++) {
    sum += dataArray[i] * dataArray[i];
  }
  const rms = Math.sqrt(sum / dataArray.length);

  const volumePercent = Math.min((rms / 50) * 100, 100);
  volumeBarEl.style.width = volumePercent + "%";

  const thresholdRMS = 95; 
  const minFreqEnergy = 25; 
  const delayMinimo = 350;
  const agora = Date.now();

  if (rms > thresholdRMS && (agora - ultimaPalma) > delayMinimo) {
    let freqMediaAlta = 0;
    const sampleRate = audioContext.sampleRate;
    const binWidth = sampleRate / analyser.fftSize;

    const startFreqHz = 2000;
    const endFreqHz = 8000;

    const startIndex = Math.floor(startFreqHz / binWidth);
    const endIndex = Math.floor(endFreqHz / binWidth);

    for (let i = startIndex; i < endIndex; i++) {
      freqMediaAlta += dataArray[i];
    }
    freqMediaAlta /= (endIndex - startIndex);

    if (freqMediaAlta > minFreqEnergy) {
      contagem++;
      atualizarContagem();
      ultimaPalma = agora;

      palmaBtn.style.transform = "scale(1.3)";
      setTimeout(() => {
        palmaBtn.style.transform = "scale(1)";
      }, 200);
    }
  }

  requestAnimationFrame(detectarPalmas);
}

// Inicializar jogo
function inicializar() {
  atualizarContagem();
  atualizarProgresso();
  mensagemMicrofoneEl.textContent = "üí° Dica: Clique em 'Ligar Microfone' para detectar palmas automaticamente!";
}

inicializar();
</script>
</body>
</html>

